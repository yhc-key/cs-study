# 01. ì‹±ê¸€í†¤ íŒ¨í„´

## âœ¨ì‹±ê¸€í†¤ì´ë€?âœ¨

```java
public class Singleton {

    private static Singleton instance = new Singleton();

    private Singleton() {
        // ìƒì„±ìëŠ” ì™¸ë¶€ì—ì„œ í˜¸ì¶œëª»í•˜ê²Œ private ìœ¼ë¡œ ì§€ì •í•´ì•¼ í•œë‹¤.
    }

    public static Singleton getInstance() {
        return instance;
    }

    public void say() {
        System.out.println("hi, there");
    }
}
```

### ğŸ“Œ ì •ì˜

**ë‹¨ í•˜ë‚˜ì˜ ìœ ì¼í•œ ê°ì²´ë¥¼ ë§Œë“¤ê¸° ìœ„í•œ ì½”ë“œ íŒ¨í„´**
ë©”ëª¨ë¦¬ ì ˆì•½ì„ ìœ„í•´ ì¸ìŠ¤í„´ìŠ¤ê°€ í•„ìš”í•  ë•Œ ë˜‘ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒˆë¡œ ë§Œë“¤ì§€ ì•Šê³  ê¸°ì¡´ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ì ¸ì™€ í™œìš©í•˜ëŠ” ê¸°ë²•

### ğŸ“Œ ì¥ì 

#### âœ”ï¸ ë©”ëª¨ë¦¬ì˜ íš¨ìœ¨ì„±

ìµœì´ˆ í•œ ë²ˆì˜ `new` ì—°ì‚°ìë¥¼ í†µí•´ì„œ ê³ ì •ëœ ë©”ëª¨ë¦¬ ì˜ì—­ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, ì¶”í›„ í•´ë‹¹ ê°ì²´ì— ì ‘ê·¼í•  ë•Œ ë©”ëª¨ë¦¬ ë‚­ë¹„ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŒ

#### âœ”ï¸ ë°ì´í„° ê³µìœ ì˜ ì‰¬ì›€

ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ê°€ ì „ì—­ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ì´ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë“¤ì´ ì ‘ê·¼í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

### ğŸ“Œ ë‹¨ì 

#### âœ”ï¸ ì˜ì¡´ì„±ì´ ë†’ì•„ì§

ì‹±ê¸€í†¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ë³€ê²½ë˜ë©´ í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ” ëª¨ë“  í´ë˜ìŠ¤ë“¤ì„ ìˆ˜ì •í•´ì•¼í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒ

#### âœ”ï¸ private ìƒì„±ì ë•Œë¬¸ì— ìƒì†ì´ ì–´ë ¤ì›€

ê¸°ë³¸ ìƒì„±ìë¥¼ privateë¡œ ë§Œë“¤ì–´ì”© ë•Œë¬¸ì— ìƒì†ì„ í†µí•œ ìì‹ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ë‹¤ëŠ” ë¬¸ì œì ì´ ìˆìŒ

- ì´ëŠ” ìë°”ì˜ ê°ì²´ì§€í–¥ ì–¸ì–´ì˜ ì¥ì  ì¤‘ í•˜ë‚˜ì¸ ë‹¤í˜•ì„±ì„ ì ìš©í•˜ì§€ ëª»í•œë‹¤ëŠ” ë¬¸ì œë¡œ ì´ì–´ì§
  - ë…ë¦½ì ì¸ í…ŒìŠ¤íŠ¸ê°€ ì§„í–‰ì´ ë˜ë ¤ë©´ ì „ì—­ì—ì„œ ìƒíƒœë¥¼ ê³µìœ í•˜ê³  ìˆëŠ” ì¸ìŠ¤í„´ìŠ¤ì˜ ìƒíƒœë¥¼ ë§¤ë²ˆ ì´ˆê¸°í™”í•´ì•¼ í•¨
  - ì´ˆê¸°í™”í•´ì£¼ì§€ ì•Šìœ¼ë©´ ì „ì—­ì—ì„œ ìƒíƒœë¥¼ ê³µìœ  ì¤‘ì´ê¸° ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë˜ì§€ ëª»í•  ê°€ëŠ¥ì„±ì´ ì¡´ì¬í•œë‹¤.

#### âœ”ï¸ í…ŒìŠ¤íŠ¸ì˜ ì–´ë ¤ì›€

ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ì¸ìŠ¤í„´ìŠ¤ëŠ” ìì›ì„ ê³µìœ í•˜ê³  ìˆë‹¤ëŠ” íŠ¹ì§•ì´ ìˆìŒ.

- ì´ëŠ” ì„œë¡œ ë…ë¦½ì ì´ì–´ì•¼ í•˜ëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ëŠ”ë° ë¬¸ì œê°€ ë¨

## âœ¨ì‹±ê¸€í†¤ êµ¬í˜„ ë°©ë²• 6ê°€ì§€âœ¨

### 1. Eager Initialization

ê°€ì¥ ê°„ë‹¨í•œ í˜•íƒœì˜ êµ¬í˜„ ë°©ë²•

- í•œë²ˆë§Œ ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘ëŠ”, ê°€ì¥ ì§ê´€ì ì´ë©´ì„œë„ ì‹¬í”Œí•œ ê¸°ë²•
- static íŠ¹ì„±ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ì¼ë‹¨ ì˜¬ë ¤ë‘ê¸° ë•Œë¬¸ì— ë¦¬ì†ŒìŠ¤ í° ê°ì²´ì¼ ê²½ìš° ê³µê°„ ìì› ë‚­ë¹„ ì‹¬í•¨
  - ê°ì²´ê°€ í¬ì§€ ì•Šì€ ê°ì²´ë¼ë©´ ì´ ê¸°ë²• ì ìš©í•´ë„ ë¬´ë¦¬ X
- ì˜ˆì™¸ ì²˜ë¦¬ ë¶ˆê°€ëŠ¥

#### âœ”ï¸ ì˜ˆì œì½”ë“œ

```java
public class Singleton {
    // ì‹±ê¸€í†¤ í´ë˜ìŠ¤ ê°ì²´ë¥¼ ë‹´ì„ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜
    private static final Singleton instance = new Singleton();

    // ì‹±ê¸€í†¤ privateë¡œ ì„ ì–¸ (ì™¸ë¶€ì—ì„œ new ì‚¬ìš© X)
    private Singleton(){}

    public static Singleton getInstance(){
        return instance;
    }
}
```

### 2. Static block initialization

`static block` ì„ ì´ìš©í•´ ì˜ˆì™¸ë¥¼ ì¡ì„ ìˆ˜ ìˆëŠ” ë°©ë²•

- `static block`: í´ë˜ìŠ¤ê°€ ë¡œë”©ë˜ê³  í´ë˜ìŠ¤ ë³€ìˆ˜ê°€ ì¤€ë¹„ëœ í›„ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ë¸”ë¡
- ì—¬ì „íˆ static íŠ¹ì„±ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ê³µê°„ ì°¨ì§€í•¨

#### âœ”ï¸ ì˜ˆì œì½”ë“œ

```java
class Singleton {
    // ì‹±ê¸€í†¤ í´ë˜ìŠ¤ ê°ì²´ë¥¼ ë‹´ì„ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜
    private static Singleton instance;

    // ìƒì„±ìë¥¼ privateë¡œ ì„ ì–¸ (ì™¸ë¶€ì—ì„œ new ì‚¬ìš© X)
    private Singleton() {}

    // static ë¸”ë¡ì„ ì´ìš©í•´ ì˜ˆì™¸ ì²˜ë¦¬
    static {
        try {
            instance = new Singleton();
        } catch (Exception e) {
            throw new RuntimeException("ì‹±ê¸€í†¤ ê°ì²´ ìƒì„± ì˜¤ë¥˜");
        }
    }

    public static Singleton getInstance() {
        return instance;
    }
}
```

### 3. Lazy Initialization

ì•ì„  ë‘ ë°©ì‹ê³¼ ë‹¬ë¦¬ ë‚˜ì¤‘ì— ì´ˆê¸°í™” í•˜ëŠ” ë°©ë²•

- ë©”ì„œë“œë¥¼ í˜¸ì¶œí–ˆì„ ë•Œ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ì˜ null ìœ ë¬´ì— ë”°ë¼ ì´ˆê¸°í™” í•˜ê±°ë‚˜ ìˆëŠ” ê±¸ ë°˜í™˜í•˜ëŠ” ê¸°ë²•
- ì•ì„  ë‘ ê°œì˜ ê³ ì • ë©”ëª¨ë¦¬ ì°¨ì§€ì˜ í•œê³„ ê·¹ë³µ
- But!! **multi-thread í™˜ê²½ì—ì„œ ë™ê¸°í™” ë¬¸ì œ**ê°€ ìˆìŒ
  - ìŠ¤ë ˆë“œ A, ìŠ¤ë ˆë“œ B ì¡´ì¬
  - Aê°€ ì•„ë˜ ì˜ˆì œì½”ë“œì—ì„œ `instance == null`ì„ íŒë‹¨í•˜ëŠ” ifë¬¸ì„ ì§„ì… -> ì•„ì§ ì´ˆê¸°í™” ì§„í–‰ X
  - Bë„ ê°™ì€ ifë¬¸ì„ í‰ê°€ -> ì•„ì§ Aê°€ ì¸ìŠ¤í„´ìŠ¤í™” ì½”ë“œ ì‹¤í–‰ì‹œí‚¤ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ifë¬¸ ì°¸ìœ¼ë¡œ ë‚˜ì˜´
  - A, B ëª¨ë‘ ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™” ì½”ë“œë¥¼ ë‘ ë²ˆ ì‹¤í–‰(ì‹±ê¸€í†¤ í´ë˜ìŠ¤ì¸ë° ê°ì²´ê°€ ë‘ ê°œê°€ ë§Œë“¤ì–´ì§)

#### âœ”ï¸ ì˜ˆì œì½”ë“œ

```java
class Singleton {
    // ì‹±ê¸€í†¤ í´ë˜ìŠ¤ ê°ì²´ë¥¼ ë‹´ì„ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜
    private static Singleton instance;

    // ìƒì„±ìë¥¼ privateë¡œ ì„ ì–¸ (ì™¸ë¶€ì—ì„œ new ì‚¬ìš© X)
    private Singleton() {}

    // ì™¸ë¶€ì—ì„œ ì •ì  ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ê·¸ì œì„œì•¼ ì´ˆê¸°í™” ì§„í–‰ (lazy)
    public static Singleton getInstance() {
        if (instance == null) {
            instance = new Singleton(); // ì˜¤ì§ 1ê°œì˜ ê°ì²´ë§Œ ìƒì„±
        }
        return instance;
    }
}
```

### 4. Thread Safe Singleton

synchronized í‚¤ì›Œë“œë¥¼ í†µí•´ ë©”ì„œë“œì— ì“°ë ˆë“œë“¤ì„ í•˜ë‚˜í•˜ë‚˜ì”© ì ‘ê·¼í•˜ê²Œ í•˜ë„ë¡ ì„¤ì •í•˜ëŠ” ë°©ë²•

- Lazy Initializationì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²•
- But!! **ì„±ëŠ¥ í•˜ë½ ë¬¸ì œ**ê°€ ìˆìŒ
  - ì—¬ëŸ¬ê°œì˜ ëª¨ë“ˆë“¤ì´ ë§¤ë²ˆ ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ë•Œ synchronized ë©”ì„œë“œë¥¼ ë§¤ë²ˆ í˜¸ì¶œí•˜ì—¬ ë™ê¸°í™” ì²˜ë¦¬ ì‘ì—…ì— overheadê°€ ë°œìƒ

```java
class Singleton {
    private static Singleton instance;

    private Singleton() {}

    // synchronized ë©”ì„œë“œ
    public static synchronized Singleton getInstance() {
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
```

### 5. Bill Pugh Singleton Implementaion â­

(ê¶Œì¥ë˜ëŠ” 2ê°œì˜ ë°©ì‹ ì¤‘ í•˜ë‚˜)

í´ë˜ìŠ¤ ì•ˆì— ë‚´ë¶€ í´ë˜ìŠ¤(holder)ë¥¼ ë‘ì–´ JVMì˜ í´ë˜ìŠ¤ ë¡œë” ë§¤ì»¤ë‹ˆì¦˜ê³¼ í´ë˜ìŠ¤ê°€ ë¡œë“œë˜ëŠ” ì‹œì ì„ ì´ìš©í•œ ë°©ë²•

- ë©€í‹°ì“°ë ˆë“œ í™˜ê²½ì—ì„œ ì•ˆì „, Lazy Loading(ë‚˜ì¤‘ì— ê°ì²´ ìƒì„±) ë„ ê°€ëŠ¥í•œ ì‹±ê¸€í†¤ ê¸°ë²•
- static ë©”ì†Œë“œì—ì„œëŠ” static ë©¤ë²„ë§Œì„ í˜¸ì¶œí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ staticìœ¼ë¡œ ì„¤ì •
- But!! **í´ë¼ì´ì–¸íŠ¸ê°€ ì„ì˜ë¡œ ì‹±ê¸€í†¤ì„ íŒŒê´´í•  ìˆ˜ ìˆë‹¤ëŠ” ë‹¨ì **ì€ ìˆìŒ

#### âœ”ï¸ ì˜ˆì œì½”ë“œ

```java
class Singleton {

    private Singleton() {}

    // static ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ ì´ìš©
    // Holderë¡œ ë§Œë“¤ì–´, í´ë˜ìŠ¤ê°€ ë©”ëª¨ë¦¬ì— ë¡œë“œë˜ì§€ ì•Šê³  getInstance ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì–´ì•¼ ë¡œë“œë¨
    private static class SingleInstanceHolder {
        private static final Singleton INSTANCE = new Singleton();
    }

    public static Singleton getInstance() {
        return SingleInstanceHolder.INSTANCE;
    }
}
```

### 6. Enum Singleton â­

(ê¶Œì¥ë˜ëŠ” 2ê°œì˜ ë°©ì‹ ì¤‘ í•˜ë‚˜)

`enum`ì„ ì´ìš©í•œ ì‹±ê¸€í†¤ íŒ¨í„´

- `enum`: ì—´ê²¨í˜• íƒ€ì…

- `enum` ì• ì´ˆì— ë©¤ë²„ë¥¼ ë§Œë“¤ë•Œ privateë¡œ ë§Œë“¤ê³  í•œë²ˆë§Œ ì´ˆê¸°í™” í•˜ê¸° ë•Œë¬¸ì— thread safeí•¨.
- `enum`ë‚´ì—ì„œ ìƒìˆ˜ ë¿ë§Œ ì•„ë‹ˆë¼, ë³€ìˆ˜ë‚˜ ë©”ì„œë“œë¥¼ ì„ ì–¸í•´ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì—, ì´ë¥¼ ì´ìš©í•´ ì‹±ê¸€í†¤ í´ë˜ìŠ¤ ì²˜ëŸ¼ ì‘ìš©ì´ ê°€ëŠ¥
- 5ë²ˆ(Bill Pugh Singleton Implementaion)ì˜ ë¬¸ì œì ë„ ì—†ìŒ

- But!! í´ë˜ìŠ¤ ìƒì†ì´ í•„ìš”í•  ë•Œ `enum` ì™¸ í´ë˜ìŠ¤ ìƒì† ë¶ˆê°€

#### âœ”ï¸ ì˜ˆì œì½”ë“œ

```java
enum SingletonEnum {
    INSTANCE;

    private final Client dbClient;

    SingletonEnum() {
        dbClient = Database.getClient();
    }

    public static SingletonEnum getInstance() {
        return INSTANCE;
    }

    public Client getClient() {
        return dbClient;
    }
}

public class Main {
    public static void main(String[] args) {
        SingletonEnum singleton = SingletonEnum.getInstance();
        singleton.getClient();
    }
}
```
